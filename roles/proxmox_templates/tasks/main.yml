---
- name: Create container templates
  ansible.builtin.include_tasks:
    file: "roles/proxmox_templates/tasks/container.yml"
  loop: "{{ hostvars['enterprise']['template_hosts'] }}"
  vars:
    #
    # required in host definition
    #
    hostname: "{{ item.name }}"
    vmid: "{{ item.vmid }}"
    vztmpl_filename: "{{ item.vztmpl_filename }}"
    ostype: "{{ item.ostype }}"
    #
    # calculated
    #
    sanitized_hostname: "{{ item.name | replace('_', '-') }}"
    template_host_record: "{{ lookup('ansible.builtin.file', (inventory_dir ~ '/secrets/mac_and_ip_addresses.json')) | ansible.builtin.from_json | ansible.builtin.json_query(hostname) }}"
    mac_address: "{{ template_host_record.mac }}"
    ip_address: "{{ template_host_record.ip }}"
    #
    # optional
    #
    cores: "{{ item.cores | default(2) }}"
    disk_size: "{{ item.disk_size | default(20) }}" # in GiB
    memory: "{{ item.memory | default(2148) }}" # in MB
    start_on_boot: "{{ item.start_on_boot | default(true) }}"
    swap: "{{ item.swap | default(512) }}"
